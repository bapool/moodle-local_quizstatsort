{"version":3,"file":"sort_statistics.min.js","sources":["../src/sort_statistics.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript to sort quiz statistics table by facility index\n *\n * @module     local_quizstatsort/sort_statistics\n * @copyright  2025 Brian A. Pool\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery'], function($) {\n    return {\n        init: function() {\n            // Find the statistics table.\n            var table = $('#questionstatistics');\n\n            if (table.length === 0) {\n                return; // Table not found, exit.\n            }\n\n            // Get tbody.\n            var tbody = table.find('tbody');\n\n            // Store original row order.\n            var originalRows = tbody.find('tr').get().slice();\n\n            // Find the facility column index from headers.\n            var facilityColumnIndex = -1;\n            var facilityHeader = null;\n\n            table.find('thead th').each(function(index) {\n                if ($(this).text().trim() === 'Facility index') {\n                    facilityColumnIndex = index;\n                    facilityHeader = $(this);\n                    return false; // Break.\n                }\n            });\n\n            if (facilityColumnIndex === -1) {\n                return; // Facility column not found.\n            }\n\n            // Track sort state: 'asc', 'desc', or 'none'.\n            var sortState = 'asc'; // Start with ascending (lowest first).\n\n            // Function to sort the table.\n            var sortTable = function(state) {\n                var rows;\n\n                if (state === 'none') {\n                    // Restore original order.\n                    rows = originalRows.slice();\n                } else {\n                    // Get current rows and sort them.\n                    rows = tbody.find('tr').get();\n\n                    rows.sort(function(a, b) {\n                        var aValue = $(a).find('td').eq(facilityColumnIndex).text().trim();\n                        var bValue = $(b).find('td').eq(facilityColumnIndex).text().trim();\n\n                        // Extract numeric value from percentage (e.g., \"68.73%\" -> 68.73).\n                        var aNum = parseFloat(aValue.replace('%', ''));\n                        var bNum = parseFloat(bValue.replace('%', ''));\n\n                        // Handle NaN (rows without facility values go to bottom).\n                        if (isNaN(aNum) && isNaN(bNum)) {\n                            return 0;\n                        }\n                        if (isNaN(aNum)) {\n                            return 1;\n                        }\n                        if (isNaN(bNum)) {\n                            return -1;\n                        }\n\n                        // Sort based on direction.\n                        if (state === 'asc') {\n                            return aNum - bNum; // Ascending (lowest first).\n                        } else {\n                            return bNum - aNum; // Descending (highest first).\n                        }\n                    });\n                }\n\n                // Reorder the table.\n                $.each(rows, function(index, row) {\n                    tbody.append(row);\n                });\n\n                // Update header to show sort direction.\n                facilityHeader.find('.sorticon').remove();\n                var icon = '';\n                if (state === 'asc') {\n                    icon = ' ▲';\n                } else if (state === 'desc') {\n                    icon = ' ▼';\n                } else {\n                    icon = ' ↕';\n                }\n                facilityHeader.append('<span class=\"sorticon\">' + icon + '</span>');\n            };\n\n            // Make the header clickable.\n            facilityHeader.css('cursor', 'pointer');\n            facilityHeader.attr('title', 'Click to cycle sort: Ascending → Descending → Unsorted');\n\n            // Add click handler.\n            facilityHeader.on('click', function() {\n                // Cycle through states: asc -> desc -> none -> asc.\n                if (sortState === 'asc') {\n                    sortState = 'desc';\n                } else if (sortState === 'desc') {\n                    sortState = 'none';\n                } else {\n                    sortState = 'asc';\n                }\n                sortTable(sortState);\n            });\n\n            // Do initial sort (ascending - lowest first).\n            sortTable(sortState);\n        }\n    };\n});\n"],"names":["define","$","init","table","length","tbody","find","originalRows","get","slice","facilityColumnIndex","facilityHeader","each","index","this","text","trim","sortState","sortTable","state","rows","sort","a","b","aValue","eq","bValue","aNum","parseFloat","replace","bNum","isNaN","row","append","remove","icon","css","attr","on"],"mappings":";;;;;;;AAuBAA,4CAAO,CAAC,WAAW,SAASC,SACjB,CACHC,KAAM,eAEEC,MAAQF,EAAE,0BAEO,IAAjBE,MAAMC,YAKNC,MAAQF,MAAMG,KAAK,SAGnBC,aAAeF,MAAMC,KAAK,MAAME,MAAMC,QAGtCC,qBAAuB,EACvBC,eAAiB,QAErBR,MAAMG,KAAK,YAAYM,MAAK,SAASC,UACH,mBAA1BZ,EAAEa,MAAMC,OAAOC,cACfN,oBAAsBG,MACtBF,eAAiBV,EAAEa,OACZ,MAIc,IAAzBJ,yBAKAO,UAAY,MAGZC,UAAY,SAASC,WACjBC,KAEU,SAAVD,MAEAC,KAAOb,aAAaE,SAGpBW,KAAOf,MAAMC,KAAK,MAAME,OAEnBa,MAAK,SAASC,EAAGC,OACdC,OAASvB,EAAEqB,GAAGhB,KAAK,MAAMmB,GAAGf,qBAAqBK,OAAOC,OACxDU,OAASzB,EAAEsB,GAAGjB,KAAK,MAAMmB,GAAGf,qBAAqBK,OAAOC,OAGxDW,KAAOC,WAAWJ,OAAOK,QAAQ,IAAK,KACtCC,KAAOF,WAAWF,OAAOG,QAAQ,IAAK,YAGtCE,MAAMJ,OAASI,MAAMD,MACd,EAEPC,MAAMJ,MACC,EAEPI,MAAMD,OACE,EAIE,QAAVX,MACOQ,KAAOG,KAEPA,KAAOH,QAM1B1B,EAAEW,KAAKQ,MAAM,SAASP,MAAOmB,KACzB3B,MAAM4B,OAAOD,QAIjBrB,eAAeL,KAAK,aAAa4B,aAC7BC,KAAO,GAEPA,KADU,QAAVhB,MACO,KACU,SAAVA,MACA,KAEA,KAEXR,eAAesB,OAAO,0BAA4BE,KAAO,YAI7DxB,eAAeyB,IAAI,SAAU,WAC7BzB,eAAe0B,KAAK,QAAS,0DAG7B1B,eAAe2B,GAAG,SAAS,WASvBpB,UANID,UADc,QAAdA,UACY,OACS,SAAdA,UACK,OAEA,UAMpBC,UAAUD"}